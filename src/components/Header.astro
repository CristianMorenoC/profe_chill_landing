---
import { getLangFromUrl, useTranslations } from "../utils/i18n";
import LanguageSwitcher from "./LanguageSwitcher";
import DarkModeToggle from "./DarkModeToggle";
import { Menu, X, ChevronRight } from "lucide-react";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header
  id="main-header"
  data-state="closed"
  class="fixed z-[2000] top-4 left-1/2 -translate-x-1/2 w-[92%] max-w-5xl
         bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl
         border border-white/20 dark:border-white/10
         shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-[0_8px_30px_rgb(0,0,0,0.2)]
         transition-[border-radius,background-color,box-shadow] duration-500 ease-[cubic-bezier(0.32,0.72,0,1)]
         flex flex-col overflow-hidden
         data-[state=closed]:rounded-full data-[state=open]:rounded-[2rem]"
>
  <!-- Main Bar -->
  <div
    class="relative z-10 px-2 pl-6 pr-2 h-14 flex items-center justify-between shrink-0"
  >
    <!-- Logo -->
    <a
      href={`/${lang}/`}
      class="text-xl font-heading font-bold text-slate-800 dark:text-white tracking-tight hover:opacity-70 transition-opacity"
    >
      Profe Chill
    </a>

    <!-- Desktop Navigation -->
    <!-- Desktop Navigation -->
    <nav
      class="hidden lg:flex items-center gap-1 bg-gray-100/50 dark:bg-white/5 px-2 py-1.5 rounded-full border border-transparent dark:border-white/5"
    >
      <a
        href={`#methodology`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.methodology")}
      </a>
      <a
        href={`#benefits`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.benefits")}
      </a>
      <a
        href={`#about`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.about")}
      </a>
      <a
        href={`#experience`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.experience")}
      </a>
      <a
        href={`#testimonials`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.testimonials")}
      </a>
      <a
        href={`#faq`}
        class="px-4 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-white dark:hover:bg-white/10 rounded-full transition-all"
      >
        {t("nav.faq")}
      </a>
    </nav>

    <!-- Right Actions -->
    <div class="flex items-center gap-2">
      <div
        class="hidden lg:flex items-center gap-2 pr-2 border-r border-gray-200 dark:border-gray-700 mr-2"
      >
        <LanguageSwitcher currentLang={lang} client:load />
        <DarkModeToggle client:load />
      </div>

      <!-- CTA (Desktop) -->
      <a
        href={`#contact`}
        class="hidden lg:inline-flex items-center justify-center px-5 py-2 text-sm font-semibold text-white bg-slate-900 dark:bg-white dark:text-slate-900 rounded-full hover:scale-105 active:scale-95 transition-all"
      >
        {t("nav.contact")}
      </a>

      <!-- Mobile Controls -->
      <div class="flex lg:hidden items-center gap-2">
        <LanguageSwitcher currentLang={lang} client:load />
        <DarkModeToggle client:load />
        <button
          id="mobile-menu-button"
          class="relative w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800 text-slate-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          aria-label="Toggle menu"
        >
          <Menu
            className="w-5 h-5 absolute transition-all duration-300 scale-100 rotate-0 data-[open=true]:scale-0 data-[open=true]:rotate-90"
            id="icon-menu"
          />
          <X
            className="w-5 h-5 absolute transition-all duration-300 scale-0 -rotate-90 data-[open=true]:scale-100 data-[open=true]:rotate-0"
            id="icon-close"
          />
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Dropdown -->
  <div
    id="mobile-menu"
    class="lg:hidden grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-[cubic-bezier(0.32,0.72,0,1)]"
  >
    <div class="overflow-hidden">
      <div class="px-4 pb-6 pt-2 flex flex-col gap-2">
        <div class="h-px w-full bg-gray-100 dark:bg-gray-800 my-2"></div>

        <a
          href="#methodology"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.methodology")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>
        <a
          href="#benefits"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.benefits")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>
        <a
          href="#about"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.about")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>
        <a
          href="#experience"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.experience")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>
        <a
          href="#testimonials"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.testimonials")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>
        <a
          href="#faq"
          class="mobile-link group flex items-center justify-between p-4 rounded-2xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="font-medium text-slate-700 dark:text-slate-200"
            >{t("nav.faq")}</span
          >
          <ChevronRight
            className="w-4 h-4 text-gray-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors"
          />
        </a>

        <a
          href="#contact"
          class="mobile-link mt-2 flex items-center justify-center p-4 rounded-2xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold hover:scale-[1.02] active:scale-[0.98] transition-all"
        >
          {t("nav.contact")}
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("main-header");
  const menuBtn = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const iconMenu = document.getElementById("icon-menu");
  const iconClose = document.getElementById("icon-close");
  const mobileLinks = document.querySelectorAll(".mobile-link");

  function toggleMenu() {
    const isOpen = header?.getAttribute("data-state") === "open";
    const newState = isOpen ? "closed" : "open";

    // Toggle Header State (Radius, etc)
    header?.setAttribute("data-state", newState);

    // Toggle Grid Expand
    if (newState === "open") {
      mobileMenu?.classList.replace("grid-rows-[0fr]", "grid-rows-[1fr]");
      iconMenu?.setAttribute("data-open", "true");
      iconClose?.setAttribute("data-open", "true");
    } else {
      mobileMenu?.classList.replace("grid-rows-[1fr]", "grid-rows-[0fr]");
      iconMenu?.removeAttribute("data-open");
      iconClose?.removeAttribute("data-open");
    }
  }

  menuBtn?.addEventListener("click", toggleMenu);

  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      // Close menu on link click
      if (header?.getAttribute("data-state") === "open") {
        toggleMenu();
      }
    });
  });
</script>
