---
import "../styles/global.css";
import SpotlightBackground from "../components/SpotlightBackground";

interface Props {
  title: string;
  description: string;
  lang: "en" | "es";
  keywords?: string;
}

const { title, description, lang, keywords } = Astro.props;
const canonicalURL = new URL(
  Astro.url.pathname,
  Astro.site || "http://localhost:4321",
);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    {keywords && <meta name="keywords" content={keywords} />}
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="/og-image.jpg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content="/og-image.jpg" />

    <!-- Alternate Languages -->
    <link rel="alternate" hreflang="en" href="/en/" />
    <link rel="alternate" hreflang="es" href="/es/" />
    <link rel="alternate" hreflang="x-default" href="/en/" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/profe-chill.svg" />

    <!-- Structured Data -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        name: "Profe Chill",
        description: description,
        provider: {
          "@type": "Person",
          name: "Juan Diego GÃ³mez",
          jobTitle: "Spanish Corporate Trainer",
          knowsLanguage: [
            "Spanish",
            "English",
            "Portuguese",
            "Italian",
            "French",
          ],
        },
        areaServed: "Worldwide",
        availableLanguage: ["Spanish", "English"],
      })}
    />

    <script is:inline>
      const theme = (() => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      })();

      if (theme === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>
  </head>
  <body class="selection:bg-brand-sky-blue/30 overflow-x-hidden">
    <!-- Global Background Layer -->
    <div
      class="fixed inset-0 z-[-2] bg-gradient-to-b from-brand-beige via-white to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-black"
    >
    </div>

    <!-- Background Image Layer (Barely visible, revealed by spotlight) -->
    <div class="fixed inset-0 z-[-1] pointer-events-none overflow-hidden">
      <img
        src="/background/bg-light.webp"
        alt=""
        class="absolute inset-0 w-full h-full object-cover opacity-5 dark:opacity-0 transition-opacity duration-700"
      />
      <img
        src="/background/bg-dark.webp"
        alt=""
        class="absolute inset-0 w-full h-full object-cover opacity-0 dark:opacity-10 transition-opacity duration-700"
      />

      {
        /* 
        This overlay facilitates the "reveal" effect. 
        The spotlight in SpotlightBackground uses radial gradients.
        By using mix-blend-mode overlay on this container, 
        the brightness of the spotlight will naturally "light up" the images underneath.
      */
      }
      <div class="absolute inset-0 bg-transparent mix-blend-overlay"></div>
    </div>

    <SpotlightBackground client:load />

    <div class="relative z-10 w-full">
      <slot />
    </div>
  </body>
</html>
